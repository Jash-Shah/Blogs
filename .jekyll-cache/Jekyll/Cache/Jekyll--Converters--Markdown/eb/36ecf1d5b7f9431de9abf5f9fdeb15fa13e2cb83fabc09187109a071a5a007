I"²<h2 id="building">Building</h2>
<p>As discussed in my last GSoC blog, I was mainly using <code class="language-plaintext highlighter-rouge">distutils</code> along with itâ€™s <code class="language-plaintext highlighter-rouge">distutils.setup</code> script to take care of all the building and linking required for building the <code class="language-plaintext highlighter-rouge">.so</code> (shared object) file required by the  Python Interpreter. However, after one of my co-mentors brought up a good point that <code class="language-plaintext highlighter-rouge">setuptools</code> is the packaging tool that is recommended by <a href="https://packaging.python.org/en/latest/guides/tool-recommendations/">PyPA</a> and also using <code class="language-plaintext highlighter-rouge">wheels</code> to package the modules instead of the standard <code class="language-plaintext highlighter-rouge">setup.py build</code> command.</p>

<p>Hence, <strong>Week 3 was spent mainly learning about <code class="language-plaintext highlighter-rouge">setuptools</code> and <code class="language-plaintext highlighter-rouge">wheels</code></strong>. <a href="https://realpython.com/python-wheels/#the-manylinux-wheel-tag">What Are Python Wheels and Why Should You Care?</a> is a great article to start with Python Wheels. The <a href="https://setuptools.pypa.io/en/latest/index.html">setuptools documentation</a> is a great place to knwo about setuptools, if you already know about distutils like me! Luckily, while <code class="language-plaintext highlighter-rouge">Setuptools</code> is a â€œbeefierâ€ version of distutils, as it offers better and more packaging utilities, it keeps the same functions, so in terms of code it was just a change of one line for me.</p>

<p>Orignally, with <code class="language-plaintext highlighter-rouge">distutils</code>, the plan was to have the files related to the Python Package in a separate <em><code class="language-plaintext highlighter-rouge">python/</code></em> directory at the root of the Gnuastro source like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ğŸ“¦python
 â”£ ğŸ“‚gnuastro.arithmetic
 â”ƒ â”£ ğŸ“œarithmetic.c
 â”ƒ â”— ğŸ”§setup.py
 â”£ ğŸ“‚gnuastro.cosmology
 â”ƒ â”£ ğŸ“œcosmology.c
 â”ƒ â”— ğŸ”§setup.py
 â”£ ğŸ“‚gnuastro.fits
 â”ƒ â”£ ğŸ“œfits.c
 â”ƒ â”— ğŸ”§setup.py
 â”— ğŸ“‘Makefile.am
</code></pre></div></div>

<p>The idea was to have the <code class="language-plaintext highlighter-rouge">setup.py</code> script in each folder build that specific extension, and let the Makefile handle the linking. But I soon realized that this was too excessive. A better structure would be:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ğŸ“¦python
 â”£ ğŸ“‚src
 â”ƒ â”£ ğŸ“œarithmetic.c
 â”ƒ â”£ ğŸ“œcosmology.c
 â”ƒ â”— ğŸ“œfits.c
 â”£ ğŸ“‘Makefile.am
 â”— ğŸ”§setup.py
</code></pre></div></div>

<h3 id="using-autotools-to-build-python-package">Using Autotools to build Python Package</h3>
<p>As the name suggests <strong>GNU</strong>astro is a GNU project, and thus depends on Autotools(<a href="https://www.gnu.org/software/automake/manual/html_node/index.html#SEC_Contents">Automake</a> and <a href="https://www.gnu.org/software/autoconf/">Autoconf</a>) for its building and compiling. These are the tools behind the</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure
make 
make check
make install
</code></pre></div></div>
<p>set of instructions. 
So, what is the difference between your traditional Makefile and using Autotools instead.
My job was to use these tools to also call the <code class="language-plaintext highlighter-rouge">setup</code> script for building my Python package.</p>

<p>Alongwith the setup script, I also added a new file(<a href="https://github.com/Jash-Shah/gnuastro-jash/blob/6997730fab6cb18fd7b34f77f9a0f65f0c7e0730/lib/python.c"><code class="language-plaintext highlighter-rouge">python.c</code></a>) to the <em>lib/</em> directory of Gnuastro. This file basically provides any utility functions I might require while building the Python package. Currently the file provides type conversion functions, which facilitates converting between Gnuastro and NumPyâ€™s datatypes.</p>

<p>My approach to build the package using Autotools involved 4 basic steps:</p>
<ol>
  <li>Adding the necessary checks in the <code class="language-plaintext highlighter-rouge">configure.ac</code> script.
    <ul>
      <li>Check if a user has Python 3 on their system and get itâ€™s include path i.e. path to <code class="language-plaintext highlighter-rouge">Python.h</code> file.</li>
      <li>If Python 3 is found, Check if the user has NumPy on their system and get itâ€™s include path.</li>
      <li>Substitute the include paths as variables to be passed to all <code class="language-plaintext highlighter-rouge">Makefile.am's</code>.</li>
    </ul>
  </li>
  <li>Conditionally build the Python package and its utility functions module(<code class="language-plaintext highlighter-rouge">lib/python.c</code>) only if the above checks are passed.</li>
  <li>Write the <code class="language-plaintext highlighter-rouge">Makefile.am</code></li>
</ol>
:ET